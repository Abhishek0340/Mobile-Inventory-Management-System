import{r as l,a as O,j as e,L}from"./index-C5rQdlcL.js";import B from"./html2canvas.esm-BfxBtG_O.js";import{A as E,M as _,f as T,g as A}from"./AdminLayout-MxYaMzDm.js";const Q=()=>{const[j,N]=l.useState([]),[x,y]=l.useState(""),[m,h]=l.useState([]),[b,f]=l.useState(null),[n,c]=l.useState(1),i=7,[a,v]=l.useState(null),d=l.useRef(null);l.useEffect(()=>{O.get("https://mobile-inventory-management-system.vercel.app/bills").then(s=>{const t=s.data.sort((r,k)=>new Date(k.billDate)-new Date(r.billDate));N(t),h(t)}).catch(s=>console.error("Error fetching orders:",s))},[]);const w=s=>{y(s.target.value)},C=()=>{const s=j.filter(t=>t.customer.name.toLowerCase().includes(x.toLowerCase()));h(s),c(1),f(s.length>0?s[0]._id:null)},D=s=>{v(s);const t=document.getElementById("invoiceModal");t.style.display="block"},p=()=>{const s=document.getElementById("invoiceModal");s.style.display="none"},I=()=>{d.current&&B(d.current).then(s=>{const t=s.toDataURL("image/png"),r=document.createElement("a");r.href=t,r.download=`Invoice_${a._id}.png`,r.click(),p()})},u=n*i,S=u-i,g=m.slice(S,u),o=Math.ceil(m.length/i),M=()=>c(s=>Math.min(s+1,o)),P=()=>c(s=>Math.max(s-1,1));return e.jsxs(E,{children:[e.jsx("div",{className:"text-sm text-gray-600 mb-4",children:e.jsxs("nav",{className:"flex items-center space-x-2",children:[e.jsx("span",{className:"text-gray-500",children:e.jsx(L,{to:"/home",children:e.jsx(_,{fontSize:20})})}),e.jsx("span",{className:"text-gray-400",children:"/"}),e.jsx("span",{className:"font-semibold text-gray-800",children:"Orders"})]})}),e.jsxs("div",{className:"p-6 min-h-screen bg-gray-50",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row justify-end items-center gap-4",children:[e.jsx("input",{type:"search",className:"w-full sm:w-auto border border-gray-300 rounded-md px-4 py-2 focus:outline-none focus:ring-2 focus:ring-blue-500 placeholder:text-gray-500",placeholder:"Search Customer Name...",value:x,onChange:w}),e.jsx("button",{className:"bg-blue-500 hover:bg-blue-600 text-white text-2xl px-4 py-2 rounded-md transition duration-200",onClick:C,children:e.jsx(T,{})})]}),e.jsx("div",{className:"overflow-x-auto bg-white rounded-lg shadow p-4 mb-6 mt-6",children:e.jsxs("table",{className:"w-full text-sm md:text-base",children:[e.jsx("thead",{className:"bg-gray-100",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-2 text-center border hidden",children:"Order ID"}),e.jsx("th",{className:"px-4 py-2 text-center ",children:"Customer Name"}),e.jsx("th",{className:"px-4 py-2 text-center list-decimal",children:"Products"}),e.jsx("th",{className:"px-4 py-2 text-center ",children:"Total Price (₹)"}),e.jsx("th",{className:"px-4 py-2 text-center ",children:"Date"}),e.jsx("th",{className:"px-4 py-2 text-center ",children:"Invoice"})]})}),e.jsx("tbody",{children:g.length>0?g.map(s=>e.jsxs("tr",{className:`border-b text-sm sm:text-base ${b===s._id?"bg-blue-50":""}`,children:[e.jsx("td",{className:"py-2  hidden",children:s._id}),e.jsx("td",{className:"py-2  text-center",children:s.customer.name}),e.jsx("td",{className:"py-2  text-left",children:e.jsx("ul",{className:"list-decimal list-inside",children:s.order.map((t,r)=>e.jsxs("li",{children:[t.productName," (x",t.quantity,") - ₹",t.price]},r))})}),e.jsxs("td",{className:"py-2 text-center",children:["₹ ",s.total]}),e.jsx("td",{className:"py-2 text-center",children:new Date(s.billDate).toLocaleString()}),e.jsx("td",{className:"py-2 text-center",children:e.jsxs("button",{onClick:()=>D(s),className:"relative group px-4 py-2 rounded-md font-bold text-xl text-blue-700 hover:text-blue-500 transition duration-200",children:[e.jsx(A,{className:"mx-auto"}),e.jsx("span",{className:"absolute -top-10 left-1/2 transform -translate-x-1/2 bg-black text-white text-xs px-2 py-1 rounded opacity-0 group-hover:opacity-100 transition duration-300 z-10",children:"Download Invoice"})]})})]},s._id)):e.jsx("tr",{children:e.jsx("td",{colSpan:"6",className:"text-center p-4",children:"No orders found"})})})]})}),e.jsxs("div",{className:"flex justify-between items-center mt-6",children:[e.jsx("button",{className:"px-4 py-2 bg-gray-300 rounded disabled:opacity-50",onClick:P,disabled:n===1,children:"Previous"}),e.jsxs("span",{className:"text-sm font-semibold",children:["Page ",n," of ",o]}),e.jsx("button",{className:"px-4 py-2 bg-gray-300 rounded disabled:opacity-50",onClick:M,disabled:n===o,children:"Next"})]}),e.jsx("div",{id:"invoiceModal",className:"fixed inset-0 flex items-center justify-center bg-black bg-opacity-50 p-4 z-50 ",children:e.jsxs("div",{ref:d,className:"bg-white rounded-lg shadow-2xl w-full max-w-lg p-6 text-gray-800",children:[e.jsxs("div",{className:"border-b pb-4 mb-4",children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"Mobile Inventory Management System"}),e.jsx("h2",{className:"text-lg font-semibold text-gray-700 mt-2",children:"Customer Invoice"})]}),a&&e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4 text-sm",children:[e.jsxs("div",{children:[e.jsx("p",{className:"font-medium",children:"Order ID:"}),e.jsx("p",{children:a._id})]}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium",children:"Date:"}),e.jsx("p",{children:new Date(a.billDate).toLocaleString()})]}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium",children:"Customer:"}),e.jsx("p",{children:a.customer.name})]}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium",children:"Mobile:"}),e.jsx("p",{children:a.customer.mobile})]}),e.jsxs("div",{className:"col-span-2",children:[e.jsx("p",{className:"font-medium",children:"Email:"}),e.jsx("p",{children:a.customer.email})]})]}),e.jsxs("div",{className:"mt-6",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-700",children:"Items Purchased"}),e.jsx("div",{className:"mt-2 border rounded-lg overflow-hidden",children:e.jsxs("table",{className:"w-full text-sm",children:[e.jsx("thead",{className:"bg-gray-100",children:e.jsxs("tr",{children:[e.jsx("th",{className:"text-left p-2",children:"Item"}),e.jsx("th",{className:"text-right p-2",children:"Qty"}),e.jsx("th",{className:"text-right p-2",children:"Price"}),e.jsx("th",{className:"text-right p-2",children:"Total"})]})}),e.jsx("tbody",{children:a.order.map((s,t)=>e.jsxs("tr",{className:"border-t",children:[e.jsx("td",{className:"p-2",children:s.productName}),e.jsx("td",{className:"text-right p-2",children:s.quantity}),e.jsxs("td",{className:"text-right p-2",children:["₹",s.price]}),e.jsxs("td",{className:"text-right p-2",children:["₹",s.totalPrice]})]},t))})]})})]}),e.jsx("div",{className:"flex justify-end mt-4",children:e.jsx("div",{className:"text-right",children:e.jsxs("p",{className:"text-lg font-bold text-gray-900",children:["Total Amount: ₹",a.total]})})}),e.jsx("p",{className:"text-center text-sm text-gray-600 mt-4",children:"Thank you for your purchase!"})]}),e.jsxs("div",{className:"mt-6 flex justify-end gap-3",children:[e.jsx("button",{onClick:I,className:"bg-green-600 hover:bg-green-700 text-white px-4 py-2 rounded-lg transition duration-200",children:"Download as Image"}),e.jsx("button",{onClick:p,className:"bg-red-500 hover:bg-red-600 text-white px-4 py-2 rounded-lg transition duration-200",children:"Close"})]})]})})]})]})};export{Q as default};
